instruction: give an example of initializing amrex and finalizing it

response:

#include <AMReX.H>
#include <iostream>

using namespace amrex;

int main(int argc, char* argv[])
{
    // Initialize AMReX (MPI, GPU backends, timers, etc.)
    Initialize(argc, argv);

    // Your code goes here
    std::cout << "AMReX is initialized!" << std::endl;

    // Finalize AMReX (clean up MPI, GPU resources, timers, etc.)
    Finalize();

    return 0;
}


instruction: give me an amrex example for writing a variable or field in the amrex data structure and plot it out

response: Here is a code snippet that creates a field on a single level and writes out a plotfile

#include <AMReX.H>
#include <AMReX_MultiFab.H>
#include <AMReX_PlotFileUtil.H>
#include <cmath>

using namespace amrex;

int main(int argc, char* argv[])
{
    // Initialize AMReX
    Initialize(argc, argv);

    // Define a simple 32x32x32 domain
    IntVect dom_lo(0,0,0), dom_hi(31,31,31);
    Box domain(dom_lo, dom_hi);

    // Create BoxArray and DistributionMapping
    BoxArray ba(domain);
    ba.maxSize(16);  // maximum grid size per box
    DistributionMapping dm(ba);

    // Create a MultiFab with 1 component and 0 ghost cells
    MultiFab mf(ba, dm, 1, 0);

    // Define real-space domain
    RealBox real_box({0.,0.,0.}, {1.,1.,1.});
    Geometry geom(domain, &real_box);

    // Cell sizes
    GpuArray<Real,3> dx = geom.CellSizeArray();

    // Fill MultiFab with a Gaussian-like function
    for (MFIter mfi(mf); mfi.isValid(); ++mfi)
    {
        const Box& bx = mfi.validbox();
        auto arr = mf.array(mfi);

        ParallelFor(bx, [=] AMREX_GPU_DEVICE(int i, int j, int k) {
            Real x = (i + 0.5) * dx[0];
            Real y = (j + 0.5) * dx[1];
            Real z = (k + 0.5) * dx[2];

            Real r2 = ((x-0.5)*(x-0.5) + (y-0.5)*(y-0.5) + (z-0.5)*(z-0.5)) / 0.01;
            arr(i,j,k) = std::exp(-r2);
        });
    }

    // Write the MultiFab to a plotfile
    WriteSingleLevelPlotfile("plt001", mf, {"Gaussian"}, geom, 0.0, 0);

    // Finalize AMReX
    Finalize();
    return 0;
}




